<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Portail Patient ‚Äì Biotrace Labs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="login-container">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo Biotrace Labs" class="logo">

        <form method="POST" onsubmit="injectCoords()">
            <label for="username">Identifiant patient</label>
            <input type="text" name="username" placeholder="Non requis" disabled>

            <label for="password">Mot de passe</label>
            <div class="password-wrapper">
                <input type="password" name="password" id="password" required>
                <span class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</span>
            </div>

            <!-- Champs cach√©s pour coord GPS -->
            <input type="hidden" name="lat" id="lat">
            <input type="hidden" name="lon" id="lon">

            <button type="submit">Valider</button>
            {% if error %}
                <p class="error">{{ error }}</p>
            {% endif %}
        </form>
    </div>

    <script>
        let userLatitude = "";
        let userLongitude = "";

        // R√©cup√®re la g√©oloc si dispo
        window.onload = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        userLatitude = position.coords.latitude;
                        userLongitude = position.coords.longitude;
                    },
                    function () {
                        console.log("G√©olocalisation refus√©e.");
                    },
                    { enableHighAccuracy: true, timeout: 5000 }
                );
            }
        };

        // Injecte les coordonn√©es GPS dans le formulaire
        function injectCoords() {
            document.getElementById("lat").value = userLatitude;
            document.getElementById("lon").value = userLongitude;
        }

        function togglePassword() {
            const pwd = document.getElementById("password");
            pwd.type = pwd.type === "password" ? "text" : "password";
        }
    </script>
</body>
</html>
